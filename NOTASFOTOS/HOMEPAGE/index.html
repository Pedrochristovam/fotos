<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Captura de Locais</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            padding: 30px;
            text-align: center;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .content {
            padding: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border: 1px solid #e1e5e9;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.15);
        }

        .card-title {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #2c3e50;
        }

        .btn-success {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }

        .map-container {
            width: 100%;
            height: 400px;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 20px;
            border: 2px solid #e1e5e9;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        .canvas-container {
            position: relative;
            border: 2px dashed #4facfe;
            border-radius: 12px;
            margin: 20px 0;
            background: #f8f9fa;
        }

        .drawing-canvas {
            border-radius: 12px;
            cursor: crosshair;
        }

        .tools-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tool-btn {
            padding: 12px 20px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tool-btn.active {
            background: #4facfe;
            color: white;
            border-color: #4facfe;
        }

        .photo-upload {
            border: 3px dashed #4facfe;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .photo-upload:hover {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            transform: translateY(-2px);
        }

        .photo-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .photo-item {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .photo-item:hover {
            transform: scale(1.05);
        }

        .photo-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .photo-item .remove-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #dc3545;
        }

        .description-container {
            display: grid;
            gap: 20px;
        }

        .photo-description {
            display: flex;
            gap: 15px;
            align-items: flex-start;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #4facfe;
        }

        .photo-description textarea {
            flex: 1;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
            min-height: 100px;
        }

        .photo-description textarea:focus {
            outline: none;
            border-color: #4facfe;
        }

        .generate-pdf {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            margin-top: 30px;
        }

        .icon {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        .hidden {
            display: none;
        }

        .loading {
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #ffffff40;
            border-top: 2px solid #ffffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #f5c6cb;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #c3e6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üó∫Ô∏è Captura de Locais</h1>
            <p>Sistema completo para documenta√ß√£o de localiza√ß√µes</p>
        </div>

        <div class="content">
            <!-- Pesquisa de Local -->
            <div class="card">
                <div class="card-title">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
                    Pesquisar Local
                </div>
                <div class="search-container">
                    <input type="text" id="searchInput" class="search-input" placeholder="Digite o endere√ßo ou nome do local...">
                    <button onclick="searchLocation()" class="btn btn-primary">
                        <svg class="icon" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
                        Pesquisar
                    </button>
                </div>
                <div id="searchResults"></div>
            </div>

            <!-- Mapa e Captura -->
            <div class="card">
                <div class="card-title">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
                    Captura do Local
                </div>
                <div class="map-container">
                    <div id="map"></div>
                </div>
                <div class="tools-container">
                    <div class="tool-btn active" data-tool="pen" onclick="selectTool('pen')">
                        <svg class="icon" viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
                        Caneta
                    </div>
                    <div class="tool-btn" data-tool="eraser" onclick="selectTool('eraser')">
                        <svg class="icon" viewBox="0 0 24 24"><path d="M16.24 3.56l4.95 4.94c.78.79.78 2.05 0 2.84L12 20.53a4.008 4.008 0 0 1-5.66 0L2.81 17c-.78-.79-.78-2.05 0-2.84l10.6-10.6c.79-.78 2.05-.78 2.83 0M4.22 15.58l3.54 3.53c.78.79 2.04.79 2.83 0l3.53-3.53-6.36-6.36-3.54 3.54c-.78.78-.78 2.05 0 2.82Z"/></svg>
                        Borracha
                    </div>
                    <div class="tool-btn" onclick="clearCanvas()">
                        <svg class="icon" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                        Limpar
                    </div>
                </div>
                <div class="canvas-container">
                    <canvas id="drawingCanvas" class="drawing-canvas" width="800" height="400"></canvas>
                </div>
                <button onclick="captureLocation()" class="btn btn-success">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
                    Capturar Local
                </button>
            </div>

            <!-- Captura do Terreno -->
            <div class="card">
                <div class="card-title">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M14 6l-3.75 5 2.85 3.8-1.6 1.2C9.81 13.75 7 10 7 10l-6 8h22L14 6z"/></svg>
                    Captura do Terreno
                </div>
                <div class="canvas-container">
                    <canvas id="terrainCanvas" class="drawing-canvas" width="800" height="400"></canvas>
                </div>
                <div class="tools-container">
                    <button onclick="setupTerrainDrawing()" class="btn btn-secondary">
                        <svg class="icon" viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
                        Desenhar Terreno
                    </button>
                    <button onclick="clearTerrainCanvas()" class="btn btn-danger">
                        <svg class="icon" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                        Limpar
                    </button>
                    <button onclick="captureTerrain()" class="btn btn-success">
                        <svg class="icon" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
                        Capturar Terreno
                    </button>
                </div>
            </div>

            <!-- Upload de Fotos -->
            <div class="card">
                <div class="card-title">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
                    Upload de Fotos
                </div>
                <div class="photo-upload" onclick="document.getElementById('photoInput').click()">
                    <svg class="icon" style="width: 48px; height: 48px; margin-bottom: 15px;" viewBox="0 0 24 24">
                        <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                    </svg>
                    <p style="font-size: 18px; font-weight: 600; margin-bottom: 10px;">Clique para adicionar fotos</p>
                    <p style="color: #6c757d;">Selecione quantas fotos desejar</p>
                </div>
                <input type="file" id="photoInput" multiple accept="image/*" class="hidden" onchange="handlePhotoUpload(event)">
                <div id="photoPreview" class="photo-preview"></div>
            </div>

            <!-- Descri√ß√µes das Fotos -->
            <div class="card" id="descriptionsCard" style="display: none;">
                <div class="card-title">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/></svg>
                    Descri√ß√µes das Fotos
                </div>
                <div id="descriptionsContainer" class="description-container"></div>
            </div>

            <!-- Gerar PDF -->
            <div class="generate-pdf">
                <button onclick="generatePDF()" class="btn btn-primary" style="font-size: 18px; padding: 20px 40px;">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/></svg>
                    Gerar Relat√≥rio PDF
                </button>
            </div>
        </div>
    </div>

    <script>
        // Vari√°veis globais
        let map;
        let currentTool = 'pen';
        let isDrawing = false;
        let uploadedPhotos = [];
        let locationData = null;
        let locationCapture = null;
        let terrainCapture = null;

        // Inicializar aplica√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            initializeMap();
            setupDrawingCanvas();
            setupTerrainCanvas();
        });

        // Inicializar mapa (simulado)
        function initializeMap() {
            const mapDiv = document.getElementById('map');
            mapDiv.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #e9ecef; color: #6c757d; font-size: 18px;">
                    <div style="text-align: center;">
                        <svg style="width: 64px; height: 64px; margin-bottom: 15px;" viewBox="0 0 24 24">
                            <path fill="currentColor" d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                        </svg>
                        <p>Pesquise um local para visualizar o mapa</p>
                        <p style="font-size: 14px; margin-top: 10px;">Integra√ß√£o com Google Maps ser√° ativada aqui</p>
                    </div>
                </div>
            `;
        }

        // Pesquisar localiza√ß√£o
        function searchLocation() {
            const searchInput = document.getElementById('searchInput');
            const query = searchInput.value.trim();
            
            if (!query) {
                showMessage('Por favor, digite um local para pesquisar.', 'error');
                return;
            }

            // Simular pesquisa
            const mapDiv = document.getElementById('map');
            mapDiv.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); color: white; font-size: 18px;">
                    <div style="text-align: center;">
                        <svg style="width: 64px; height: 64px; margin-bottom: 15px;" viewBox="0 0 24 24">
                            <path fill="currentColor" d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                        </svg>
                        <p><strong>${query}</strong></p>
                        <p style="font-size: 14px; margin-top: 10px;">Localiza√ß√£o encontrada - Mapa carregado</p>
                    </div>
                </div>
            `;

            locationData = {
                address: query,
                timestamp: new Date().toLocaleString('pt-BR')
            };

            showMessage('Local encontrado com sucesso!', 'success');
        }

        // Configurar canvas de desenho
        function setupDrawingCanvas() {
            const canvas = document.getElementById('drawingCanvas');
            const ctx = canvas.getContext('2d');
            
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
        }

        function setupTerrainCanvas() {
            const canvas = document.getElementById('terrainCanvas');
            const ctx = canvas.getContext('2d');
            
            // Desenhar fundo do terreno
            ctx.fillStyle = '#8bc34a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Adicionar grid
            ctx.strokeStyle = '#689f38';
            ctx.lineWidth = 1;
            for (let i = 0; i < canvas.width; i += 40) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, canvas.height);
                ctx.stroke();
            }
            for (let i = 0; i < canvas.height; i += 40) {
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(canvas.width, i);
                ctx.stroke();
            }
        }

        function setupTerrainDrawing() {
            const canvas = document.getElementById('terrainCanvas');
            
            canvas.addEventListener('mousedown', startTerrainDrawing);
            canvas.addEventListener('mousemove', drawTerrain);
            canvas.addEventListener('mouseup', stopTerrainDrawing);
            canvas.addEventListener('mouseout', stopTerrainDrawing);
            
            showMessage('Modo de desenho do terreno ativado!', 'success');
        }

        let terrainDrawing = false;

        function startTerrainDrawing(e) {
            terrainDrawing = true;
            const canvas = document.getElementById('terrainCanvas');
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            
            ctx.beginPath();
            ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
        }

        function drawTerrain(e) {
            if (!terrainDrawing) return;
            
            const canvas = document.getElementById('terrainCanvas');
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            
            ctx.lineWidth = 3;
            ctx.strokeStyle = '#2196f3';
            ctx.lineCap = 'round';
            ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
        }

        function stopTerrainDrawing() {
            terrainDrawing = false;
        }

        // Ferramentas de desenho
        function selectTool(tool) {
            currentTool = tool;
            document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-tool="${tool}"]`).classList.add('active');
        }

        function startDrawing(e) {
            isDrawing = true;
            const canvas = document.getElementById('drawingCanvas');
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            
            ctx.beginPath();
            ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
        }

        function draw(e) {
            if (!isDrawing) return;
            
            const canvas = document.getElementById('drawingCanvas');
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            
            if (currentTool === 'pen') {
                ctx.globalCompositeOperation = 'source-over';
                ctx.lineWidth = 2;
                ctx.strokeStyle = '#e74c3c';
            } else if (currentTool === 'eraser') {
                ctx.globalCompositeOperation = 'destination-out';
                ctx.lineWidth = 20;
            }
            
            ctx.lineCap = 'round';
            ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function clearCanvas() {
            const canvas = document.getElementById('drawingCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function clearTerrainCanvas() {
            setupTerrainCanvas();
        }

        // Capturar imagens
        function captureLocation() {
            if (!locationData) {
                showMessage('Por favor, pesquise um local primeiro.', 'error');
                return;
            }
            
            const canvas = document.getElementById('drawingCanvas');
            locationCapture = canvas.toDataURL();
            showMessage('Captura do local realizada com sucesso!', 'success');
        }

        function captureTerrain() {
            const canvas = document.getElementById('terrainCanvas');
            terrainCapture = canvas.toDataURL();
            showMessage('Captura do terreno realizada com sucesso!', 'success');
        }

        // Upload de fotos
        function handlePhotoUpload(event) {
            const files = Array.from(event.target.files);
            
            files.forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const photo = {
                            id: Date.now() + Math.random(),
                            file: file,
                            dataUrl: e.target.result,
                            name: file.name,
                            description: ''
                        };
                        uploadedPhotos.push(photo);
                        updatePhotoPreview();
                        updateDescriptions();
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        function updatePhotoPreview() {
            const preview = document.getElementById('photoPreview');
            preview.innerHTML = '';
            
            uploadedPhotos.forEach((photo, index) => {
                const photoDiv = document.createElement('div');
                photoDiv.className = 'photo-item';
                photoDiv.innerHTML = `
                    <img src="${photo.dataUrl}" alt="${photo.name}">
                    <button class="remove-btn" onclick="removePhoto(${photo.id})">√ó</button>
                `;
                preview.appendChild(photoDiv);
            });

            // Mostrar card de descri√ß√µes se houver fotos
            const descriptionsCard = document.getElementById('descriptionsCard');
            descriptionsCard.style.display = uploadedPhotos.length > 0 ? 'block' : 'none';
        }

        function removePhoto(photoId) {
            uploadedPhotos = uploadedPhotos.filter(photo => photo.id !== photoId);
            updatePhotoPreview();
            updateDescriptions();
        }

        function updateDescriptions() {
            const container = document.getElementById('descriptionsContainer');
            container.innerHTML = '';
            
            uploadedPhotos.forEach((photo, index) => {
                const descDiv = document.createElement('div');
                descDiv.className = 'photo-description';
                descDiv.innerHTML = `
                    <div style="min-width: 100px;">
                        <img src="${photo.dataUrl}" style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px;">
                        <p style="margin-top: 8px; font-weight: 600; color: #4facfe;">Foto ${index + 1}</p>
                    </div>
                    <textarea 
                        placeholder="Descreva a Foto ${index + 1}..."
                        onchange="updatePhotoDescription(${photo.id}, this.value)"
                        value="${photo.description}"
                    >${photo.description}</textarea>
                `;
                container.appendChild(descDiv);
            });
        }

        function updatePhotoDescription(photoId, description) {
            const photo = uploadedPhotos.find(p => p.id === photoId);
            if (photo) {
                photo.description = description;
            }
        }

        // Gerar PDF
        async function generatePDF() {
            if (!locationData) {
                showMessage('Por favor, pesquise um local primeiro.', 'error');
                return;
            }

            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<div class="loading"><div class="spinner"></div>Gerando PDF...</div>';
            button.disabled = true;

            try {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                let yPosition = 20;

                // T√≠tulo do relat√≥rio
                pdf.setFontSize(24);
                pdf.setTextColor(40, 40, 40);
                pdf.text('Relat√≥rio de Captura de Local', 20, yPosition);
                yPosition += 15;

                // Linha separadora
                pdf.setDrawColor(79, 172, 254);
                pdf.setLineWidth(1);
                pdf.line(20, yPosition, 190, yPosition);
                yPosition += 15;

                // Informa√ß√µes do local
                pdf.setFontSize(16);
                pdf.setTextColor(79, 172, 254);
                pdf.text('üìç Localiza√ß√£o', 20, yPosition);
                yPosition += 8;
                
                pdf.setFontSize(12);
                pdf.setTextColor(40, 40, 40);
                pdf.text(`Endere√ßo: ${locationData.address}`, 20, yPosition);
                yPosition += 6;
                pdf.text(`Data/Hora: ${locationData.timestamp}`, 20, yPosition);
                yPosition += 15;

                // Captura do local (se dispon√≠vel)
                if (locationCapture) {
                    pdf.setFontSize(16);
                    pdf.setTextColor(79, 172, 254);
                    pdf.text('üó∫Ô∏è Captura do Local', 20, yPosition);
                    yPosition += 10;
                    
                    try {
                        pdf.addImage(locationCapture, 'PNG', 20, yPosition, 170, 85);
                        yPosition += 95;
                    } catch (e) {
                        pdf.setFontSize(10);
                        pdf.setTextColor(100, 100, 100);
                        pdf.text('Erro ao adicionar imagem da captura do local', 20, yPosition);
                        yPosition += 10;
                    }
                }

                // Captura do terreno (se dispon√≠vel)
                if (terrainCapture) {
                    if (yPosition > 200) {
                        pdf.addPage();
                        yPosition = 20;
                    }
                    
                    pdf.setFontSize(16);
                    pdf.setTextColor(79, 172, 254);
                    pdf.text('üèûÔ∏è Captura do Terreno', 20, yPosition);
                    yPosition += 10;
                    
                    try {
                        pdf.addImage(terrainCapture, 'PNG', 20, yPosition, 170, 85);
                        yPosition += 95;
                    } catch (e) {
                        pdf.setFontSize(10);
                        pdf.setTextColor(100, 100, 100);
                        pdf.text('Erro ao adicionar imagem da captura do terreno', 20, yPosition);
                        yPosition += 10;
                    }
                }

                // Fotos e descri√ß√µes
                if (uploadedPhotos.length > 0) {
                    if (yPosition > 200) {
                        pdf.addPage();
                        yPosition = 20;
                    }
                    
                    pdf.setFontSize(16);
                    pdf.setTextColor(79, 172, 254);
                    pdf.text('üì∏ Fotos Documentadas', 20, yPosition);
                    yPosition += 15;

                    for (let i = 0; i < uploadedPhotos.length; i++) {
                        const photo = uploadedPhotos[i];
                        
                        // Verificar se precisa de nova p√°gina
                        if (yPosition > 200) {
                            pdf.addPage();
                            yPosition = 20;
                        }

                        // T√≠tulo da foto
                        pdf.setFontSize(14);
                        pdf.setTextColor(40, 40, 40);
                        pdf.text(`Foto ${i + 1}: ${photo.name}`, 20, yPosition);
                        yPosition += 10;

                        // Adicionar foto
                        try {
                            pdf.addImage(photo.dataUrl, 'JPEG', 20, yPosition, 80, 60);
                        } catch (e) {
                            pdf.setFontSize(10);
                            pdf.setTextColor(100, 100, 100);
                            pdf.text('Erro ao carregar imagem', 20, yPosition);
                        }

                        // Descri√ß√£o da foto
                        if (photo.description) {
                            pdf.setFontSize(10);
                            pdf.setTextColor(60, 60, 60);
                            const description = photo.description || 'Sem descri√ß√£o';
                            const lines = pdf.splitTextToSize(description, 85);
                            pdf.text(lines, 110, yPosition + 10);
                        }

                        yPosition += 70;
                    }
                }

                // Rodap√©
                const pageCount = pdf.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    pdf.setPage(i);
                    pdf.setFontSize(8);
                    pdf.setTextColor(150, 150, 150);
                    pdf.text(`P√°gina ${i} de ${pageCount}`, 20, 285);
                    pdf.text(`Gerado em ${new Date().toLocaleString('pt-BR')}`, 120, 285);
                }

                // Salvar PDF
                const filename = `relatorio_${locationData.address.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
                pdf.save(filename);
                
                showMessage('PDF gerado com sucesso!', 'success');
                
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                showMessage('Erro ao gerar PDF. Tente novamente.', 'error');
            } finally {
                button.innerHTML = originalText;
                button.disabled = false;
            }
        }

        // Fun√ß√µes auxiliares
        function showMessage(message, type) {
            const existingMessage = document.querySelector('.error-message, .success-message');
            if (existingMessage) {
                existingMessage.remove();
            }

            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
            messageDiv.textContent = message;
            
            const firstCard = document.querySelector('.card');
            firstCard.parentNode.insertBefore(messageDiv, firstCard);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        // Permitir pesquisa com Enter
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchLocation();
            }
        });

        // Drag and drop para fotos
        const photoUpload = document.querySelector('.photo-upload');
        
        photoUpload.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.style.backgroundColor = '#e3f2fd';
        });
        
        photoUpload.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.style.backgroundColor = '';
        });
        
        photoUpload.addEventListener('drop', function(e) {
            e.preventDefault();
            this.style.backgroundColor = '';
            
            const files = Array.from(e.dataTransfer.files);
            const imageFiles = files.filter(file => file.type.startsWith('image/'));
            
            if (imageFiles.length > 0) {
                imageFiles.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const photo = {
                            id: Date.now() + Math.random(),
                            file: file,
                            dataUrl: e.target.result,
                            name: file.name,
                            description: ''
                        };
                        uploadedPhotos.push(photo);
                        updatePhotoPreview();
                        updateDescriptions();
                    };
                    reader.readAsDataURL(file);
                });
            }
        });
    </script>
</body>
</html>